#!/usr/bin/perl


# get environment variables
my $cmssw_version = get_env_variable("CMSSW_VERSION");
my $cmssw_base    = get_env_variable("CMSSW_BASE");
my $java_home     = get_env_variable("JAVA_HOME");
#my $oracle_home   = get_env_variable("ORACLE_HOME");
#my $mysql_home    = get_env_variable("MYSQL_HOME");


# build the ConfDbGUI jar file if necessary
my $confdb_gui_jar = "$cmssw_base/src/EventFilter/ConfigDB/lib/cmssw-evf-confdb-gui.jar";
my $classpath      = $confdb_gui_jar;

if (!-e $confdb_gui_jar)
{
    print "\nBuilding $confdb_gui_jar ...\n";
    my $pwd = `pwd`; chomp($pwd);
    `cd $cmssw_base/src/EventFilter/ConfigDB`;
    my $oldpath = $ENV{"PATH"};
    $ENV{"PATH"} = "$java_home/bin:$oldpath";
    `classic-ant`;
    $ENV{"PATH"} = $oldpath;
    `cd $pwd`;

    if (-e $confdb_gui_jar)
    {
	print "$confdb_gui_jar successfully built.\n";
    }
    else { die ("Failed to build $confdb_gui_jar\n"); }
}

# add MySQL JDBC Driver to claspath
$classpath = $classpath . ":ext/mysql-connector-java-5.0.5-bin.jar";

# add Oracle JDBC Driver to classpath
$classpath = $classpath . ":ext/ojdbc14.jar";

# add swing-layout-1.0.jar to classpath for org.jdesktop.layout.* support
$classpath = $classpath . ":ext/swing-layout-1.0.jar";

# start the GUI
`rm -f ConfDbGUI.log`;
system("$java_home/bin/java -classpath $classpath confdb.gui.ConfDbGUI");

exit 0;


#-------------------------------------------------------------------------------
# subroutines
#-------------------------------------------------------------------------------

#_______________________________________________________________________________
sub get_env_variable
{
    my ($varname) = @_;
    my $result;
    if (defined $ENV{$varname}) 
    {
	$result = $ENV{$varname};
	print "\$" . $varname . " = $result\n";
    }
    else { die ("ERROR: \$" . $varname . " undefined!"); }
    return $result;
}
