# ----------------------------------------------------------------------
# NOTE: Example cfg file to generate Bs -> mu+ mu- with PYTHIA. 
# ----- Any other process could be entered as well.
#       This is with MSEL=5 (gluon-gluon fusion) => this is ONLY for quick testing
#       A much better choice is MSEL=1, but this will take ~100 times longer
#       "scratch" is a symlink to where you have space for the outputfile
# ----------------------------------------------------------------------

process Rec =  {
  untracked PSet maxEvents = {untracked int32 input = 100}

  untracked PSet ReleaseValidation = {
    untracked uint32 totalNumberOfEvents = 100
    untracked uint32 eventsPerJob        = 100
    untracked string primaryDatasetName  = 'Bs2MuMu'
  }

  untracked PSet configurationMetadata = {
    untracked string version = "The great escape"
    untracked string name = "Bs -> mu+ mu-"
    untracked string annotation = "Merlot del Ticino"
  }

  include "Configuration/ReleaseValidation/data/Services.cff"
  include "Configuration/StandardSequences/data/FakeConditions.cff"
  include "FWCore/MessageService/data/MessageLogger.cfi"
    
  untracked PSet options = {
    include "FWCore/Framework/test/cmsExceptionsFatalOption.cff"
    untracked bool wantSummary = true
    untracked bool makeTriggerResults = true 
  }

  source = PythiaSource { 
    untracked int32 pythiaPylistVerbosity = 0
    untracked bool pythiaHepMCVerbosity   = false
    untracked int32 maxEventsToPrint      = 0  
    untracked double filterEfficiency     = 1.

    PSet PythiaParameters = {
      # This is a vector of ParameterSet names to be read, in this order
      vstring parameterSets = {
        "pythiaUESettings", 
        "processParameters"
      }

      include "Configuration/Generator/data/PythiaUESettings.cfi"
 
      vstring processParameters = {

        'PMAS(5,1)=4.8          ! b quark mass', 
        'MSEL=5                 ! Min Bias', 
        'MDME(953,2) = 0        ! PHASE SPACE',
        'BRAT(953)   = 1.       ! BRANCHING FRACTION',
        'KFDP(953,1) =  13      ! mu-',
        'KFDP(953,2) = -13      ! mu+',
        'KFDP(953,3) = 0        ! nada',
        'KFDP(953,4) = 0        ! nada',
        'KFDP(953,5) = 0        ! nada',

        'PMAS(140,1) = 5.369',

        'MDME(953,1) = 0        ',
        'MDME(954,1) = 0        ',
        'MDME(955,1) = 0        ',
        'MDME(956,1) = 0        ',
        'MDME(957,1) = 0        ',
        'MDME(958,1) = 0        ',
        'MDME(959,1) = 0        ',
        'MDME(960,1) = 0        ',
        'MDME(961,1) = 0        ',
        'MDME(962,1) = 0        ',
        'MDME(963,1) = 0        ',
        'MDME(964,1) = 0        ',
        'MDME(965,1) = 0        ',
        'MDME(966,1) = 0        ',
        'MDME(967,1) = 0        ',
        'MDME(968,1) = 0        ',
        'MDME(969,1) = 0        ',
        'MDME(970,1) = 0        ',
        'MDME(971,1) = 0        ',
        'MDME(972,1) = 0        ',
        'MDME(973,1) = 0        ',
        'MDME(974,1) = 0        ',
        'MDME(975,1) = 0        ',
        'MDME(976,1) = 0        ',
        'MDME(977,1) = 0        ',
        'MDME(978,1) = 0        ',
        'MDME(979,1) = 0        ',
        'MDME(980,1) = 0        ',
        'MDME(981,1) = 0        ',
        'MDME(982,1) = 0        ',
        'MDME(983,1) = 0        ',
        'MDME(984,1) = 0        ',
        'MDME(985,1) = 0        ',
        'MDME(986,1) = 0        ',
        'MDME(987,1) = 0        ',
        'MDME(988,1) = 0        ',
        'MDME(989,1) = 0        ',
        'MDME(990,1) = 0        ',
        'MDME(991,1) = 0        ',
        'MDME(953,1) = 1       !  Bs -> mu mu '
      }
    }
  }


  # -- Filter dimuon kinematical acceptance
  module MuMuFilter = MCParticlePairFilter {
    untracked vint32 ParticleID1 = {13}
    untracked vint32 ParticleID2 = {13}
    untracked int32 ParticleCharge = -1
    untracked vint32 Status = {1,1}
    untracked vdouble MinPt = {2.5,2.5}
    untracked vdouble MinEta = {-2.5,-2.5}
    untracked vdouble MaxEta = {2.5,2.5}
    untracked double MinInvMass = 5.3
    untracked double MaxInvMass = 5.5
  }

  # -- Require Muon from Bs
  module MuFilter = PythiaFilter {
    untracked int32 ParticleID = 13
    untracked double MinEta = -2.5
    untracked double MaxEta = 2.5
    untracked double MinPt = 2.5
    untracked int32 Status = 1
    untracked int32 MotherID = 531
  }

  include "Configuration/StandardSequences/data/Reconstruction.cff"
  include "Configuration/StandardSequences/data/Simulation.cff"
  include "Configuration/StandardSequences/data/MixingNoPileUp.cff" 
  include "Configuration/StandardSequences/data/VtxSmearedGauss.cff" 
  include "Configuration/StandardSequences/data/L1Emulator.cff"

  path p0 = {MuMuFilter & MuFilter} # generator filtering
  path p1 = {psim} # simulation
  path p2 = {pdigi} # digitization
  path p3 = {reconstruction_plusRS_plus_GSF} # reconstruction
  path p4 = {L1Emulator}

  include "Configuration/EventContent/data/EventContent.cff"

  module FEVT = PoolOutputModule { 
    using FEVTSIMEventContent
    untracked string fileName = "scratch/bs2mumu.root"
    untracked PSet dataset = {	
      untracked string dataTier = "GEN-SIM-DIGI-RECO"
    }
    untracked PSet SelectEvents = {
      vstring SelectEvents = { "p0" }
    }  
  }

  endpath outpath = {FEVT}

  schedule = {p0,p1,p2,p3,p4,outpath}
}
