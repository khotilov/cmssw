#!/bin/bash
[ -e /tmp/headers1.txt ] || ./classes_extract 
[ -e /tmp/headers2.txt ] || ./classes_extract2
cd ${CMSSW_RELEASE_BASE}/src
echo -n '^int
^long
^double
^char
^float
^short
^unsigned
^void
^Bool_t
^Char_t
^Double32_t
^Int_t
^Long64_t
^UInt_t
^bool
^boost::any
^boost::int16_t
^boost::int8_t
^boost::uint16_t
^boost::uint32_t
^boost::uint8_t
^char
^cms_uint16_t
^cms_uint32_t
^cms_uint64_t
^const double
^const int
^const static int
^const_iterator
^const_iterator_imp\*
^headers_const_iterator
^const_std::type_info
^const_void\*
^double
^int
^int32_t
^long
^long_long
^mutable bool
^mutable int
^mutable float
^mutable std::map< int16_t, uint32_t >
^mutable std::vector<double>
^short
^signed char
^uint16_t
^uint32_t
^uint8_t
^unsigned
^unsigned_char
^unsigned_int
^unsigned_long
^unsigned_long_long
^unsigned_short
^void\*
^static bool
^static const bool
^static const short
^static const char \*
^static const cms_uint32_t
^static const cms_uint64_t
^static const double
^static const float
^static const uint32_t
^static const unsigned
^static const int
^static const uint16_t
^static const unsigned int
^static const unsigned long long
^static int
^static const unsigned short
^static std::vector<std::string>
^static std::string
^static size_t const
^static const size_type
^static unsigned int const
'|sort -u > /tmp/exempt.txt
cat /tmp/headers1.txt | sort -u | ctags -f - -L - | sort -u >/tmp/class_members1.txt 
cat /tmp/headers2.txt | sort -u | ctags -f - -L - | sort -u >/tmp/class_members2.txt 
cd - 2>&1 >/dev/null;
for class in `cat /tmp/classes1.txt | sort -u`;do grep -e "${class}$" /tmp/class_members1.txt |  awk '/\tm\t(class):/ {print }' | awk '{for (i=4; i <= NF-1 ; i++){ printf("%s ", $i)};printf "%s\n", $NF}' | awk 'BEGIN{FS=";"} {print $1, $3}' | awk '{for (i=1;i<=NF;i++) {printf("%s ",$i)};printf "\n"}'|awk 'BEGIN{FS="\" m class:";} {print }' ;done | grep -v -f /tmp/exempt.txt | sort -u >/tmp/members1.txt
for class in `cat /tmp/classes2.txt | sort -u`;do grep -e "${class}$" /tmp/class_members2.txt |  awk '/\tm\t(class):/ {print }' | awk '{for (i=4; i <= NF-1 ; i++){ printf("%s ", $i)};printf "%s\n", $NF}' | awk 'BEGIN{FS=";"} {print $1, $3}' | awk '{for (i=1;i<=NF;i++) {printf("%s ",$i)};printf "\n"}'|awk 'BEGIN{FS="\" m class:";} {print }' ;done | grep -v -f /tmp/exempt.txt | sort -u >/tmp/members2.txt
