%======================================================================
% To compile this file you have to set the .tex file path:
% setenv TEXINPUTS .:${PWD}/../../../::
%
% Use latex or pdflatex to compile.
%
% Author: C.Leonidopoulos, E. Meschi (parts stolen from N. Amapane)
% $Date: 2007/03/21 12:36:59 $  $Revision: 1.11 $
%
%======================================================================
\documentclass[a4paper]{cmspaper}
\usepackage{lineno} % line numbering for draft
\usepackage{ifthen}

%======================================================================
% Check for PDFLaTeX/LaTeX 

\newif\ifpdf
\ifx\pdfoutput\undefined
\pdffalse 
\else
\pdfoutput=1 
\pdftrue
\fi

\ifpdf  % ============== we are running PDFLaTeX
\usepackage{color}
\usepackage[pdftex]{graphicx,graphics}
\usepackage{epsfig}
\usepackage{pdflscape}
\usepackage[bookmarksnumbered,bookmarksopen,bookmarksopenlevel=1,
              colorlinks,
              linkcolor=blue,                      
              citecolor=blue, 
              urlcolor=blue]{hyperref}                                 
\pdfinfo{
  /Title  (DQM Project Document)
  /Author (...)
  /Keywords (DQM, Online, DAQ, CMS)
  }

\DeclareGraphicsExtensions{.pdf}

\else   % ============== we are not running PDFLaTeX
\usepackage{epsfig}
\usepackage{lscape}

\DeclareGraphicsExtensions{.eps}

%fake pdflatex commands.
\newcommand{\pdfbookmark}[3][1]{}
\newcommand{\href}[2]{#2}

\fi

%==============================================================================

\newcommand {\ie}{\mbox{\sl i.e. }}     %i.e.
\newcommand {\eg}{\mbox{\sl e.g. }}     %e.g.

\begin{document}

%==============================================================================
% title page for few authors

\begin{titlepage}

% select one of the following and type in the proper number:
%   \cmsnote{2005/000}
%  \cmsnote{2007/XYZ}
%  \conferencereport{2005/000}
   \date{\today}
\smallskip
\smallskip
\rightline{\bf Version 0.1}

\vspace{1cm}

\title{DQM Group Project Document\\[0.5cm]
\normalsize }

\vspace{1cm}

  \begin{Authlist}
%     Authors
%       \Instfoot{Institut}{Institut}
    G.\,Della Ricca, A.\,Meyer, A.\,Rizzi, I.\,Segoni, L.\,Tuura
    
  \end{Authlist}

% if needed, use the following:
%\collaboration{Flying Saucers Investigation Group}
%\collaboration{CMS collaboration}

\vspace{1cm}

  \begin{abstract}
    \pdfbookmark[1]{Abstract}{Abstract}
    The note describes the baseline central CMS Data Quality Monitoring 
    and Data Certification System. Tasks for development, commissioning and 
    operation of DQM services are listed.
  \end{abstract} 

% if needed, use the following:
%\conference{Presented at {\it Physics Rumours}, Coconut Island, April 1, 2005}
%\submitted{Submitted to {\it Physics Rumours}}
%\note{Preliminary version}
  
\end{titlepage}

\thispagestyle{empty}
\tableofcontents

\newpage

\setcounter{page}{1}%JPP
%\linenumbers
%===============================================================================================

\section{Introduction} 
\label{sec:introduction}

Data Quality Monitoring is critically important for the detector and operation efficiency
and for the reliable certification of the recorded data for physics analyses. 
The CMS end-to-end DQM chain comprises
\begin{itemize}
\item live online detector and trigger monitoring (section \ref{sec:online})
\item offline reconstruction monitoring (section \ref{sec:offline})
\item data certification of events and datasets for physics analysis (section
\ref{sec:certification})
\item the visualization of the monitoring results (\ref{sec:gui}).
\end{itemize}

The CMS DQM software framework provides tools for the creation, filling, transport, archival and visualization of histograms. The software includes standardized algorithms to perform automated quality and validity tests on the DQM distributions. 
DQM processes are operating on the online data in P5 as well as during offline processing at the Tier-0, 1, 2 centers. 
In addition the DQM system is in use or will be used for other purposes, such as
\begin{itemize}
\item the monitoring of calibration processing and the validation of the calibration results
\item the validation of software releases
\item the monitoring of the DAQ hardware status and data throughput
\item the retrieval of DQM-relevant quantities from the conditions database
\end{itemize}
Use of DQM tools is also foreseen for the interactive and semi-automated processing of data at the CAF. 

\section{The CMS-wide DQM Group} 
\label{sec:charge}

A CMS-wide DQM group has been created with the aim to realize the above described goals 
in an efficient and standardized way for all CMS. The group carries the following charge.

\subsection{Charge to the DQM Group}
Data Quality Monitoring appears in various places across the experiment.
The charge of the DQM Groups is as follows:
\begin{itemize}
\item   identify the places, and construct the end-to-end connected chain, where DQM is done
\item   coordinate the technical implementation, including the software architecture and the service deployment, and harmonize the code and procedures used in DQM across the experiment
\item  identify and make widely available the most important plots and features to assure that data being taken and being analysed are of good quality
\item   identify the different timescales (or Dt) for reporting of DQM information required at the places identified in the above-mentioned connected end-to-end chain
\item  evaluate health of runs and identify "good runs". Moreover, tag each event with the appropriate detector conditions to indicate which detector information can be used.
\end{itemize}

\paragraph{Composition of the DQM Group}
The Group will be convened by two physicists (I. Segoni, A. Meyer) and a technical coordinator (L.
Tuura).
One DQM expert from each of the sub-detector DPGs (Tracker, ECAL, HCAL, Muons(2), Level-1 Trigger, DAQ) and areas (HLT, Commissioning and Run, Offline and Physics) will be assigned.

%CHECK need alca here

\paragraph{Reporting}
The DQM conveners will report via the Commissioning and Run Coordinator and the Spokesperson to MP3

\paragraph{Timeline}
First report in May, interim report in CMS Week in June, first deployment during the CRAFT after Cyprus Week.


\subsection{Near future Goals and Priorities}

Given the above charges the near future priorities must be to finish the
development, implementation and deployment of the complete code base for the end-to-end system
and to establish and consolidate the DQM system operation with minimal maintenance needs. 

% Introduction
%===============================================================================================
%===============================================================================================
%===============================================================================================
% Online 

\section{The Online DQM System}
\label{sec:online}
\input{online}
%===============================================================================================
%===============================================================================================
%===============================================================================================
% Offline 
\section{The Offline DQM System}
\label{sec:offline}
\input{offline}

% Offline 
%===============================================================================================
%===============================================================================================
%===============================================================================================
% Certification 
\section{The Data Certification System}
\label{sec:certification}
\input{certification}

% Certification
%===============================================================================================
%===============================================================================================
%===============================================================================================
% GUI
\section{The Graphical User Interface Webserver System}
\label{sec:gui}
\input{gui}

% GUI (Lassi)
%===============================================================================================
%===============================================================================================
%===============================================================================================
% Other systems

\section{DQM Interfaces To Other Systems}

\subsection{Database} 
\label{sec:database}

Automated and interactive DQM makes use of databases in various places. In particular
the DQM analyzers access the database through the standard CMSSW EventSetup interface.

Beyond that the main interest for DQM to use the database is for the purpose of
history and trend plotting. Quantities available in DQM client applications, such as summary quantities of histograms (e.g.\,means and widths of distributions) as well as the results from quality tests can be stored in the conditions database. Once in the database these conditions data produced by DQM clients can be correlated with non-event conditions data such as temperatures or DAQ monitoring information (trend-plots). Similarly history plots can be produced by plotting a given database-resident quantity versus time or runnumber.
A unified scheme of database usage for DQM purposes is being explored in cooperation between the subsystems and the database group.

In this context, the database group has proposed to re-use the DQM GUI for access 
to database information. 
The exactly requirements and needs are still to be worked out, based on input
from the subsystems, and the availability of qualified persons to work on the development and implementation of this interface needs to be confirmed, before a more detailed description can be given.

\begin{figure}[!htbp]
\begin{center}
\includegraphics[width=0.9\textwidth]{DB}
\caption{Online Databases. Figure taken from \cite{talk:pigi}.}
\end{center}
\label{fig:database}
\end{figure}

% CHECK: some details in talks by 
%\bibitem{talk:giovanni} G.Franzoni,
%talk at DQM Workshop 27 August 2007,\\
%http://indico.cern.ch/conferenceDisplay.py?confId=19909
%\bibitem{talk:kcira} D.Kcira
%talk at weekly EvF/DQM meeting 31 May 2007,\\
%http://indico.cern.ch/conferenceDisplay.py?confId=15919\#6

\subsection{DAQ Monitor System}

The DAQ monitoring system XMAS provides access to live and persistent non-event 
(conditions) data describing the Detector hardware and readout system.
Work is ongoing to provide an interface which would allow that DQM applications 
can transparently receive online XMAS conditions data.
The near term goal is to create a DQM application which produces DQM histograms
containing distributions of DAQ system quantities.

\subsection{Computing Monitoring}

%=======================================================
% this subsection is common to all sections, please keep
\subsection{Integration and Support for Other Systems}

\subsubsection*{Integration}

\subsubsection*{Operation}


\section{DQM System Optimization}

\subsection{Core Software}
Core software components are largely in place now. 
In addition, experience with testing and operation within quasi-real production conditions
(e.g. CRUZET, CSA08) is bringing out a number of areas where
optimization is required in order to arrive at the design performance.

\subsection{Histograms, Alerts and Certification Algorithms}

This will be part of the DQM group's job:
\begin{itemize}
\item Standardization and refinement of DQM quality criteria.
\item Refinement of the selection of histograms relevant for online DQM.
\item Integration of validated source modules for operation in HLT.
\end{itemize}

\section{Summary}

\subsection{Technical Developments Summary}

A list of uncovered development issues is given in table \ref{tab:summary:devel}.

\begin{table}[h]
\begin{center}
\begin{tabular}{||l|l|l||}
\hline \hline
       & Description & FTE \\
       \hline
Online & Detector status, alarm and report & \\
       & summary logging to database & 1 month FTE \\
       & Commissioning of online DQM in HLT / run control & 3 months FTE \\
Offline & Scaling and production testing of harvesting step & \\ 
        & Integration of DQM task from Calibration and Alignment & \\ 
        & Layout of DQM at CAF & \\ 
Certification & Development of data certification framework code, & \\ 
         & i.e. read and combine DCS, DAQ and DQM info, & \\
	 & write output to DBS and condDB & 2 FTE for 4 months \\
GUI &  & \\
Core &  & \\
\hline \hline
\end{tabular}
\end{center}
\label{tab:summary:devel}
\caption{List of presently not sufficiently covered development projects with high priority}
\end{table}

\subsection{DQM System Integration and Operation Summary}

A list of integration, operation and maintenance tasks is given in table \ref{tab:summary:operation}.
Details can be found in the respective sections above.

\begin{table}[h]
\begin{center}
\begin{tabular}{||l|l|l||}
\hline \hline
       & Description & FTE \\
       \hline 
Core   &  Maintenance and Release Coordination  &
          for DQM, DQMOffline, Validation \\
       &  Subsystem support and code reviews \\
Online &  System operation and maintenance & \\
       &  24/7 on-call expert coverage & \\
       &  shifter instructions and supervision & \\
       &  documentation & \\
Offline &  & \\
Certification &  & \\
GUI &  & \\
Core &  & \\
\hline \hline
\end{tabular}
\end{center}
\label{tab:summary:operation}
\caption{List of Uncovered Development and Operation Tasks}
\end{table}


\begin{thebibliography}{99}

\bibitem{workshop070827} DQM Workshop 27 August 2007
\bibitem{webtools} CMS Data Management Webtools https://twiki.cern.ch/twiki/bin/view/CMS/DMWebtools
\bibitem{iguana} G.Eulisse, https://twiki.cern.ch/twiki/bin/view/CMS/CMSSW\_dqmIGUANAGUI
\bibitem{guimeeting} D.Menasce, L.Tuura, S.Dutta, P.Merkel, Private
communication
\bibitem{talk:lassi} L.Tuura, talk at weekly EvF/DQM meeting, 7 June 2007
http://indico.cern.ch/getFile.py/\\
access?contribId=29\&sessionId=6\&resId=0\&materialId=slides\&confId=16991
\bibitem{dqmbrowser} http://cmsmon.cern.ch/cmsdb/servlet/DQMBrowser?RUN=$<$runnumber$>$
\bibitem{talk:pigi} P.Paolucci,
talk at CMS annual review 15 June 07,
http://indico.cern.ch/getFile.py/\\
access?contribId=28\&resId=1\&materialId=slides\&confId=16736
\bibitem{talk:harry} H.Cheung, 
talk at DQM Workshop 27 August 2007, \\
http://indico.cern.ch/conferenceDisplay.py?confId=19909
\bibitem{datacert:gutsche} 
   http://indico.cern.ch/getFile.py/access?contribId=48\&sessionId=21\&resId=0\&materialId=slides\&c
onfId=28445   
\bibitem{datacert:meyer}   
   http://indico.cern.ch/getFile.py/access?resId=0\&materialId=slides\&contribId=44\&sessionId=21\&s
ubContId=1\&confId=28445

\end{thebibliography}
\end{document}



%%% Notes
%    +developments     
%     + core: timescale for baseline DQM
%       - history plots
%       - geometric navigation
%       - HIER NOCH MEHR PUNKTE EINFUEGEN
%       - make DQM software exportable, e.g. to Tier-1 and 2
%     + finish development and implementation of DQM file archival system
%       (online and offline).
%     + core: write summary online DQM information to conditions DB
%     + core: organize forwarding of relevant DB information from 
%       omds/orcon to orcoff
%     + core: set up framework for retrieval, calculation 
%       and writing of data certification info
%     + algorithms to be implemented by subsystems
%     
%     +technical developments and extension of DQM GUI and parts of framework 
%      for
%      + DAQ
%      + DB
%    +deployment
%     + implementation/use of HLTconfDB for DQM
%     + deployment of HLT DQM
%     + consolidation / run control integration of DQM off SM
%     + production testing of offline DQM at Tier-0
%     + implementation/support for AlcaReco Workflows
%     + validation of CSA08
%    +operation
%     + P5 (2 FTE for remaining developments, consolidation, on-call support)
%     + Tier-0
%     + support for CAF
%    +communication/documentation/user support/planning
