#! /bin/env cmsRun

process combinedsv = {
    include "FWCore/MessageLogger/data/MessageLogger.cfi"
    # replace MessageLogger.cerr.default.limit = 1000000
    # replace MessageLogger.debugModules = { "combinedSV" }

    source = PoolSource {
      untracked vstring fileNames = { "file:cc.root"}
# untracked vstring fileNames = { '/store/mc/2006/12/22/mc-physval-120-BBbar50to80-LowLumiPU/0016/001E138D-DB97-DB11-91F8-003048767D6B.root' }
        untracked int32 maxEvents = 1
        # untracked uint32 skipEvents = 1
    }

    include "MagneticField/Engine/data/volumeBasedMagneticField.cfi"
    include "Geometry/TrackerSimData/data/trackerSimGeometryXML.cfi"
    include "TrackingTools/TransientTrack/data/TransientTrackBuilder.cfi"
    include "RecoVertex/PrimaryVertexProducer/data/OfflinePrimaryVerticesFromCTFTracks.cfi"

    // replace offlinePrimaryVerticesFromCTFTracks.useBeamConstraint = true
    // include "RecoVertex/Configuration/data/RecoVertex.cff"
    include "RecoJets/JetProducers/data/CaloJetIcone5.cfi"
    # include "RecoBTag/CombinedSV/test/jettracksassociator.cfi"
    include "RecoBTau/JetTracksAssociator/data/jetTracksAssociator.cff"
    # include "RecoBTag/CombinedSV/test/trackcounting.cfi"

    module combinedSV = CombinedSV
    {
      string jetTracks = "jetTracksAssociator"
      string xmlFileName = "combinedsvcalibration.xml"
      string vertexcoll = "offlinePrimaryVerticesFromCTFTracks"
      # string vertexcoll = "none"
      string trackcoll = "ctfWithMaterialTracks"
      double charmPriorInBG = 0.25

      include "RecoBTag/CombinedSV/test/vertexreco.cfi"
      include "RecoBTag/CombinedSV/test/vertexcuts.cfi"
      include "RecoBTag/CombinedSV/test/jetcuts.cfi"
      include "RecoBTag/CombinedSV/test/trackcuts.cfi"
    }

    # module execution
    path p = { iterativeCone5CaloJets, jetTracksAssociator, offlinePrimaryVerticesFromCTFTracks,
               combinedSV }

    module out = PoolOutputModule {
      untracked string fileName = "file:bjets_sv.root"
      # untracked vstring outputCommands = { "drop *" }
    }

    endpath outpath = { out }
}
