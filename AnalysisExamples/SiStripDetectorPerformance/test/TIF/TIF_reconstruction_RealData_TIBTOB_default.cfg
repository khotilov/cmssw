process TRACKRECONSTRUCTION = {

  #service = Timing{}
   
  ######## MessageLogger ########
  include "FWCore/MessageLogger/data/MessageLogger.cfi" 

  ############ File Input ############
  source = PoolSource {
    untracked vstring fileNames =  {
    }

    untracked int32 maxEvents = -1
    untracked uint32 debugVebosity = 1
    untracked bool   debugFlag     = true
  }

  ############ Access to ORCOFF via Frontier ############
  es_source = PoolDBESSource {
    VPSet toGet = {
      { string record = "SiStripPedestalsRcd" string tag = "SiStripPedNoise_TIBTOB_v1_p"},
      { string record = "SiStripNoisesRcd" string tag = "SiStripPedNoise_TIBTOB_v1_n"},
      { string record = "SiStripFedCablingRcd" string tag = "SiStripCabling_TIBTOB_v1"}
    }
   
    untracked bool siteLocalConfig = true
    string connect = "frontier://cms_conditions_data/CMS_COND_STRIP"
    string timetype = "runnumber"

   PSet DBParameters ={
      untracked string authenticationPath = ""
      untracked bool loadBlobStreamer = true
   }
  }

  es_module sistripconn = SiStripConnectivity {}

  
  ############ Digitization ############
  include "EventFilter/SiStripRawToDigi/data/SiStripDigis.cfi"

  # ZeroSuppression
  include "RecoLocalTracker/SiStripZeroSuppression/data/SiStripZeroSuppression.cfi"


  ############ Cluster Reconstruction ############
  include "RecoLocalTracker/SiStripClusterizer/data/SiStripClusterizer_RealData.cfi"
  replace siStripClusters.ChannelThreshold    = 2.0
  replace siStripClusters.SeedThreshold       = 3.0
  replace siStripClusters.ClusterThreshold    = 5.0

  # SiStripClusterInfoProducer
  include "AnalysisAlgos/SiStripClusterInfoProducer/data/SiStripClusterInfoProducer.cfi"


  ############ General Tracking ############
  include "RecoLocalTracker/SiStripRecHitConverter/data/SiStripRecHitMatcher.cfi"
  include "RecoLocalTracker/SiStripRecHitConverter/data/SiStripRecHitConverter.cfi"
  
  # set magnetic field to 0
  replace UniformMagneticFieldESProducer.ZFieldInTesla = 0.0
 
  #stripCPE
  include "RecoLocalTracker/SiStripRecHitConverter/data/StripCPEfromTrackAngle.cfi"
  #pixelCPE
  include "RecoLocalTracker/SiPixelRecHits/data/PixelCPEParmError.cfi"

  # track reco for TIFTIBTOB
  #include "RecoTracker/Configuration/data/RecoTrackerTIFTIBTOB.cff"
 
  # cosmic track finder seeding
  include "RecoTracker/TkSeedGenerator/data/CosmicSeedTIFTIBTOB.cff"

  # cosmic track finder pattern recognition and track fit
  include "RecoTracker/SingleTrackPattern/data/CosmicTrackFinderTIFTIBTOB.cff"

  # Seeds 
  include "RecoTracker/SpecialSeedGenerators/data/CombinatorialSeedGeneratorForCosmicsTIFTIBTOB.cff"

  # Ckf
  include "RecoTracker/CkfPattern/data/CkfTrackCandidatesTIFTIBTOB.cff"

  # Final Fit
  include "RecoTracker/TrackProducer/data/CTFFinalFitWithMaterialTIFTIBTOB.cff"

  # RoadSearchSeedFinder
  include "RecoTracker/RoadSearchSeedFinder/data/RoadSearchSeedsTIFTIBTOB.cff"

  # RoadSearchCloudMaker
  include "RecoTracker/RoadSearchCloudMaker/data/RoadSearchCloudsTIFTIBTOB.cff"

  # RoadSearchTrackCandidateMaker
  include "RecoTracker/RoadSearchTrackCandidateMaker/data/RoadSearchTrackCandidatesTIFTIBTOB.cff"

  # RS track fit with material 
  include "RecoTracker/TrackProducer/data/RSFinalFitWithMaterialTIFTIBTOB.cff"

  # include track info
  #include "AnalysisAlgos/TrackInfoProducer/data/TrackInfoProducerTIFTIBTOB.cff"
  replace rsWithMaterialTracksTIFTIBTOB.TrajectoryInEvent = true
  replace ctfWithMaterialTracksTIFTIBTOB.TrajectoryInEvent = true
  replace cosmictrackfinderTIFTIBTOB.TrajInEvents = true

  module  trackinfoRSTIFTIBTOB = trackinfo from "AnalysisAlgos/TrackInfoProducer/data/TrackInfoProducer.cfi"
  replace trackinfoRSTIFTIBTOB.cosmicTracks  = rsWithMaterialTracksTIFTIBTOB
  replace trackinfoRSTIFTIBTOB.rechits  = rsWithMaterialTracksTIFTIBTOB

  module  trackinfoCTFTIFTIBTOB = trackinfo from "AnalysisAlgos/TrackInfoProducer/data/TrackInfoProducer.cfi"
  replace trackinfoCTFTIFTIBTOB.cosmicTracks  = ctfWithMaterialTracksTIFTIBTOB
  replace trackinfoCTFTIFTIBTOB.rechits  = ctfWithMaterialTracksTIFTIBTOB

  module  trackinfoCosmicTFTIFTIBTOB = trackinfo from "AnalysisAlgos/TrackInfoProducer/data/TrackInfoProducer.cfi"
  replace trackinfoCosmicTFTIFTIBTOB.cosmicTracks  = cosmictrackfinderTIFTIBTOB
  replace trackinfoCosmicTFTIFTIBTOB.rechits  = cosmictrackfinderTIFTIBTOB

  sequence trackinfoTIFTIBTOB = {trackinfoRSTIFTIBTOB,trackinfoCTFTIFTIBTOB,trackinfoCosmicTFTIFTIBTOB}

  sequence ckftracksTIFTIBTOB = {combinatorialcosmicseedfinderTIFTIBTOB, ckfTrackCandidatesTIFTIBTOB,ctfWithMaterialTracksTIFTIBTOB}              
  sequence rstracksTIFTIBTOB  = {roadSearchSeedsTIFTIBTOB, roadSearchCloudsTIFTIBTOB, rsTrackCandidatesTIFTIBTOB, rsWithMaterialTracksTIFTIBTOB}
  sequence cosmictracksTIFTIBTOB = {cosmicseedfinderTIFTIBTOB, cosmictrackfinderTIFTIBTOB}

  sequence tracksTIFTIBTOB = {cosmictracksTIFTIBTOB, ckftracksTIFTIBTOB, rstracksTIFTIBTOB, trackinfoTIFTIBTOB}
  

  ############# track reconstruction sequence and output  #############

  module DIGI-RECO = PoolOutputModule {
         untracked string fileName = "TIF_reconstruction_RealData_TIBTOB_default.root"
         untracked PSet datasets ={
           untracked PSet dataset1 = {
              untracked string dataTier = "DIGI"
           }
           untracked PSet dataset2 = {
              untracked string dataTier = "RECO"
           }
         }
  }

  sequence digitization   = {SiStripDigis,siStripZeroSuppression}
  sequence clusterization = {siStripClusters,siStripClusterInfoProducer}

  sequence local_reco = {siStripMatchedRecHits}

  path p = {digitization,clusterization,local_reco,tracksTIFTIBTOB}

  endpath e = { DIGI-RECO }

}

