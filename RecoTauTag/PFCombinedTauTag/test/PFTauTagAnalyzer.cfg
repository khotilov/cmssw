#! /bin/env cmsRun

process myPFTauTagAnalyzer = {
  
service = AdaptorConfig {}
source = PoolSource{
  untracked vstring fileNames = { 	
    "rfio:/castor/cern.ch/user/h/houchu/DiTaus-Pt20To420_Reco131dir/mc_physval_131_DiTaus_Pt20To420_1.root",
    "rfio:/castor/cern.ch/user/h/houchu/DiTaus-Pt20To420_Reco131dir/mc_physval_131_DiTaus_Pt20To420_2.root",
    "rfio:/castor/cern.ch/user/h/houchu/DiTaus-Pt20To420_Reco131dir/mc_physval_131_DiTaus_Pt20To420_3.root"	
  }
  #untracked int32 maxEvents = -1
  untracked int32 maxEvents = 1000
}

include "TrackingTools/TransientTrack/data/TransientTrackBuilder.cfi"
   
# Message Logger
include "FWCore/MessageLogger/data/MessageLogger.cfi"
replace MessageLogger.cout.threshold = "ERROR"

# Magnetic Field
include "MagneticField/Engine/data/volumeBasedMagneticField.cfi"

# Geometry
include "Geometry/CommonDetUnit/data/globalTrackingGeometry.cfi"
include "Geometry/CaloEventSetup/data/CaloGeometry.cfi"
include "Geometry/CaloEventSetup/data/CaloTopology.cfi"

include "RecoVertex/PrimaryVertexProducer/data/OfflinePrimaryVerticesFromCTFTracks.cfi"

include "RecoTracker/TkSeedGenerator/data/GlobalMixedSeeds.cff"
include "RecoTracker/CkfPattern/data/CkfTrackCandidates.cfi"
include "RecoTracker/TrackProducer/data/RefitterWithMaterial.cfi"
include "RecoTracker/TrackProducer/data/CTFFinalFitWithMaterial.cff"
include "TrackingTools/GsfTracking/data/GsfElectronFit.cfi"

include "RecoParticleFlow/PFClusterProducer/data/particleFlowCluster.cff"
include "RecoParticleFlow/PFTracking/data/particleFlowTrack.cff"
include "RecoParticleFlow/PFTracking/data/elecPreId.cff"
include "RecoParticleFlow/PFBlockProducer/data/particleFlowSimParticle.cff"
include "RecoParticleFlow/PFBlockProducer/data/particleFlowBlock.cff"
include "RecoParticleFlow/PFProducer/data/particleFlow.cff"
include "RecoParticleFlow/PFProducer/data/particleFlowJetCandidates.cfi"
     
include "RecoTauTag/PFCombinedTauTag/data/pfConeIsolation.cfi"
include "RecoTauTag/PFCombinedTauTag/data/pfCombinedTauTag.cfi"

### Begin of DB config #######################################################
include "CondCore/DBCommon/data/CondDBCommon.cfi"

#replace CondDBCommon.connect = "sqlite_file:tautagnew1.db"  
#replace CondDBCommon.catalog = "file:mycatalog.xml"
replace CondDBCommon.connect = "oracle://cms_orcoff_int2r/CMS_COND_BTAU"    
replace CondDBCommon.catalog = "relationalcatalog_oracle://cms_orcoff_int2r/CMS_COND_GENERAL"            
  
replace CondDBCommon.DBParameters.messageLevel = 3
replace CondDBCommon.DBParameters.authenticationPath = "/afs/cern.ch/cms/DB/conddb"
es_source = PoolDBESSource { 
  using CondDBCommon
  VPSet toGet = { { string record = "CombinedTauTagRcd" string tag = "combinedtautag_likelihoodratioPDFs_0" } }
}
module get = EventSetupRecordDataGetter { 
  VPSet toGet = { { string record = "CombinedTauTagRcd" vstring data = {"CombinedTauTagCalibration"} } }
  untracked bool verbose = true 
}
### End of DB config #######################################################

module thePFTauTagAnalyzer=PFTauTagAnalyzer{
   #string PFRecTrackProd = "particleFlowTrack"
   string PFRecTrackProd = "elecpreid"
   string PFSimParticleProd = "particleFlowSimParticle"
   string PFBlockElementTrackProd = "particleFlowBlock"
   string PFCombinedTauTagProd = "pfCombinedTauTag"
   #string PVProd = "pixelVertices"
   string PVProd = "offlinePrimaryVerticesFromCTFTracks"
   bool test_useOnlyChargedHadrCand = true
   double test_Cand_minpt = 1.5
   bool test_useOnlyChargedHadrforleadPFCand = true
   double test_trackercone_size = 0.5
   double test_matchingcone_size = 0.17
   double test_leadCand_minpt = 6.
   string output_filename = "test.root"
}
# module execution
path p={globalMixedSeeds,ckfTrackCandidates,ctfWithMaterialTracks,offlinePrimaryVerticesFromCTFTracks,particleFlowCluster,particleFlowTrack,particleFlowSimParticle,particleFlowBlock,particleFlow,particleFlowJetCandidates,iterativeCone5PFJets,mypfConeIsolation,pfCombinedTauTag,thePFTauTagAnalyzer}
}
