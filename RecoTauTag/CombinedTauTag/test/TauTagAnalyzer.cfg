#! /bin/env cmsRun

process myTauTagAnalyzer = {
  
service = AdaptorConfig {}

source = PoolSource{
  untracked vstring fileNames = { 	
    'rfio:/castor/cern.ch/user/f/fwyzard/dataset/1.3.0-pre3/FEVT/mc-physval-120-BBbar80to120-LowLumiPU/04B6AEF9-65A0-DB11-A809-0002B3AFAFDB.root'
  }
  untracked int32 maxEvents = -1
}

include "TrackingTools/TransientTrack/data/TransientTrackBuilder.cfi"

# Message Logger
include "FWCore/MessageLogger/data/MessageLogger.cfi"
replace MessageLogger.cout.threshold = "INFO"

# Magnetic Field
include "MagneticField/Engine/data/volumeBasedMagneticField.cfi"

# Geometry
include "Geometry/CommonDetUnit/data/globalTrackingGeometry.cfi"
include "Geometry/CaloEventSetup/data/CaloGeometry.cfi"
include "Geometry/CaloEventSetup/data/CaloTopology.cfi"
       
include "RecoTauTag/CombinedTauTag/data/coneIsolation.cfi"
include "RecoTauTag/CombinedTauTag/data/combinedTauTag.cfi"

### Begin of DB config #######################################################
include "CondCore/DBCommon/data/CondDBCommon.cfi"
replace CondDBCommon.connect = "sqlite_file:tautagnew.db"    
replace CondDBCommon.catalog = "file:mycatalog.xml"
replace CondDBCommon.DBParameters.messageLevel = 3
replace CondDBCommon.DBParameters.authenticationPath = "/afs/cern.ch/cms/DB/conddb"
es_source = PoolDBESSource { 
  using CondDBCommon
  VPSet toGet = { { string record = "CombinedTauTagRcd" string tag = "combinedtautag_tag" } }
}
module get = EventSetupRecordDataGetter { 
    VPSet toGet = { { string record = "CombinedTauTagRcd" vstring data = {"CombinedTauTagCalibration"} } }
    untracked bool verbose = true 
}
##### End of DB config #######################################################

module theTauTagAnalyzer=TauTagAnalyzer{
   string CombinedTauTagProd = "combinedTauTag"
   string PVProd = "pixelVertices"
   string output_filename = "test.root"
}

# module execution
path p={coneIsolation,combinedTauTag,get,theTauTagAnalyzer}
}
